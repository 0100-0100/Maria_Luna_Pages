{% extends "base.html" %}
{% load static %}

{% block styles %}
  <link rel="stylesheet" href="{% static 'css/home.css' %}">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <style>
  #map {
    width: 100vw;
    height: calc(100vh - 50px);
  }
  </style>
{% endblock %}

{% block title %}Home{% endblock %}

{% block content %}
  <section>
    <div id="map"></div>
  </section>
{% endblock %}

{% block script %}
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script>
  var map = L.map('map', {
    crs: L.CRS.Simple,
    minZoom: 2,
    maxZoom: 5
  });
  var w = 8192, h = 5851;
  var imageBounds = [[0, 0], [-h, w]];
  map.fitBounds(imageBounds);
  map.setView([-94, 103], 2)
  L.tileLayer('/static/map/tiles/{z}-{x}-{y}.webp', {
    tileSize: 256,
    minZoom: 2,
    maxZoom: 5,
    zoomOffset: 0,
    bounds: imageBounds,
    noWrap: true
  }).addTo(map);
  //L.imageOverlay("/static/map/map.webp", imageBounds).addTo(map);
  // Fetch locations dynamically
  fetch('/api/locations/')
      .then(response => response.json())
      .then(data => {
        data.forEach(loc => {
          var marker = L.marker([h - loc.y, loc.x], {
            icon: L.icon({iconUrl: loc.icon, iconSize: [32, 32]})
          }).addTo(map);
          marker.bindPopup("<b>" + loc.name + "</b>");
        });
      });
  </script>
{% endblock %}
