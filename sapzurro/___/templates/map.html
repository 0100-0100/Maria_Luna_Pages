{% extends "base.html" %}
{% load static %}

{% block styles %}
  <link rel="stylesheet" href="{% static 'css/map.css' %}">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <style>
  #map {
    width: 100vw;
    height: calc(100vh - 50px);
  }
  </style>
{% endblock %}

{% block title %}Home{% endblock %}

{% block content %}
  <section>
    <div id="map"></div>
  </section>
{% endblock %}

{% block script %}
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script>
  const w = 8192;
  const h = 5851;

  var map = L.map('map', {
    crs: L.CRS.Simple,
    minZoom: 2,
    maxZoom: 5,
    zoomControl: false,
    attributionControl: false
  }).setView([0, 0], 0);

  L.control.zoom({ position: 'bottomright' }).addTo(map);
  const southWest = map.unproject([0, h], map.getMaxZoom());
   northEast = map.unproject([w, 0], map.getMaxZoom());
  let bounds = L.latLngBounds(southWest, northEast);

  L.tileLayer('/static/map/tiles/{z}-{x}-{y}.webp', {
    tileSize: 256,
    minZoom: 2,
    maxZoom: 5,
    zoomOffset: 0,
    center: [0, 0],
    noWrap: true,
    tms: false,
    bounds: bounds
  }).addTo(map);
  map.setMaxBounds(bounds);
  // Fetch locations dynamically
  fetch('/api/locations/')
    .then(response => response.json())
    .then(data => {
      data.forEach(loc => {
        var marker = L.marker(
          [loc.y, loc.x],
          {
            icon: L.icon({
              iconUrl: loc.icon,
              iconSize: [64, 64],
              className: 'map-marker-0',
            })
          }
        ).addTo(map);
        marker.bindPopup("<b>" + loc.name + "</b>");
      });
    });
  </script>
{% endblock %}
